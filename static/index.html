<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AimPointer - Controle por Ponteiro</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/threejs-visualizer.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Three.js carregado primeiro -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo">
                    <div class="logo-icon">🎯</div>
                    <div class="app-title">AimPointer</div>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Desconectado</span>
                </div>
            </div>
            <button class="config-header-btn" onclick="toggleConfig()">
                ⚙️ Configurações
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="content-area">
            <div class="pointer-container">
                <div class="pointer-visual">
                    <div class="pointer-grid"></div>
                    <div class="crosshair-line crosshair-horizontal"></div>
                    <div class="crosshair-line crosshair-vertical"></div>
                    <div class="pointer-crosshair" id="crosshair"></div>
                </div>
            </div>
            
            <div class="instructions">
                <div class="instruction-card">
                    <div class="instruction-title">
                        🎮 Controle por Ponteiro
                    </div>
                    Aponte o dispositivo como um controle remoto. O cursor seguirá naturalmente sua direção.
                </div>
            </div>
        </div>
        
        <!-- Bottom Controls -->
        <div class="bottom-controls">
            <div class="click-buttons">
                <button class="click-btn left-click" onclick="leftClick()">
                    🖱️ Esquerdo
                </button>
                <button class="click-btn right-click" onclick="rightClick()">
                    🖱️ Direito
                </button>
            </div>
        </div>
    </div>
    
    <!-- Configuration Panel -->
    <div class="config-panel" id="configPanel">
        <div class="config-header">
            <div class="config-title">Configurações</div>
            <button class="close-config" onclick="toggleConfig()">×</button>
        </div>
        
        <div class="config-content">
            <!-- Conexão -->
            <div class="config-section">
                <div class="section-title">Conexão</div>
                
                <div class="connected-devices">
                    <div class="input-label">Dispositivos Conectados</div>
                    <div class="devices-list" id="devicesList">
                        <div class="device-item">
                            <span>Este dispositivo</span>
                            <div class="device-status">
                                <div class="device-dot" id="thisDeviceDot"></div>
                                <span>Conectado</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">IP do Servidor</label>
                    <input type="text" class="input-field" id="serverIp" value="192.168.1.104">
                </div>
                <button class="action-btn" onclick="toggleWebSocket()" id="connectBtn">
                    Conectar WebSocket
                </button>
            </div>
            
            <!-- Sensores -->
            <div class="config-section">
                <div class="section-title">Sensores</div>
                <button class="action-btn" onclick="toggleSensors()" id="sensorBtn">
                    Ativar Sensores
                </button>

                <!-- Novo toggle: usar acelerômetro para estabilização -->
                <div class="toggle-container" style="margin-top:0.75rem;">
                    <span class="toggle-label">Usar Acelerômetro (estabilização)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="useAccelerometerToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="sensor-data">
                    <div class="data-item">
                        <div class="data-label">Direção X</div>
                        <div class="data-value" id="directionX">0°</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Direção Y</div>
                        <div class="data-value" id="directionY">0°</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Rotação Z</div>
                        <div class="data-value" id="directionZ">0°</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Precisão</div>
                        <div class="data-value" id="accuracy">0%</div>
                    </div>
                </div>
                
                <div class="performance-info">
                    <div>FPS: <span id="fpsCounter">0</span></div>
                    <div>Resolução: <span id="resolutionInfo">1920x1080</span></div>
                </div>
            </div>
            
            <!-- Sensibilidade -->
            <div class="config-section">
                <div class="section-title">Sensibilidade</div>
                <div class="input-group">
                    <label class="input-label">Área de Apontamento: <span id="sensitivityValue">60</span>°</label>
                    <input type="range" class="sensitivity-slider" id="sensitivity" 
                           min="30" max="120" value="60" step="5">
                </div>
                <div class="input-label" style="font-size: 0.7rem; color: var(--text-muted);">
                    Controla quantos graus de movimento cobrem a tela.
                </div>
            </div>
            
            <!-- Calibração Avançada -->
            <div class="config-section">
                <div class="section-title">Calibração Avançada</div>
                
                <!-- Visualizador 3D Samsung Note Ultra-Realista -->
                <div class="device-visualizer-3d" id="deviceVisualizer">
                    <div id="threejs-container"></div>
                    <div class="orientation-indicator" id="orientationIndicator">
                        X:0° Y:0° Z:0°
                    </div>

                    <!-- Nova caixa do acelerômetro -->
                    <div class="accelerometer-indicator" id="accelerometerIndicator">
                        Accel X:0.00 Y:0.00 Z:0.00
                    </div>
                </div>
                
                <!-- Informação da Posição Inicial -->
                <div class="initial-position-info" id="initialPositionInfo">
                    ⚠️ A posição inicial será usada como referência para toda a calibração
                </div>
                
                <!-- Progresso -->
                <div class="calibration-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Pronto para começar</div>
                </div>
                
                <!-- Passos Interativos -->
                <div class="calibration-steps">
                    <div class="calibration-step" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-text">Defina a posição inicial de referência</div>
                        <button class="step-confirm-btn" onclick="confirmStep(1)">Confirmar</button>
                    </div>
                    <div class="calibration-step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-text">Gire 90° para a esquerda</div>
                        <button class="step-confirm-btn" onclick="confirmStep(2)">Confirmar</button>
                    </div>
                    <div class="calibration-step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-text">Gire 90° para a direita</div>
                        <button class="step-confirm-btn" onclick="confirmStep(3)">Confirmar</button>
                    </div>
                    <div class="calibration-step" id="step4">
                        <div class="step-number">4</div>
                        <div class="step-text">Volte para posição inicial</div>
                        <button class="step-confirm-btn" onclick="confirmStep(4)">Confirmar</button>
                    </div>
                </div>
                
                <div class="calibration-buttons">
                    <button class="calibration-btn" onclick="startAdvancedCalibration()" id="startCalibrationBtn">
                        Iniciar Calibração
                    </button>
                    <button class="calibration-btn" onclick="resetCalibration()">
                        Resetar
                    </button>
                </div>
            </div>
            
            <!-- Estabilização -->
            <div class="config-section">
                <div class="section-title">Estabilização</div>
                
                <div class="toggle-container">
                    <span class="toggle-label">Fusão de Sensores</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="sensorFusionToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="input-group">
                    <label class="input-label">Suavização: <span id="smoothingValue">75</span>%</label>
                    <input type="range" class="sensitivity-slider" id="smoothingFactor" 
                           min="50" max="90" value="75" step="5">
                </div>

                <div class="input-group">
                    <label class="input-label">Compensação: <span id="compensationValue">2</span></label>
                    <input type="range" class="sensitivity-slider" id="compensation" 
                           min="1" max="5" value="2" step="1">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="toggleConfig()"></div>

    <!-- Scripts na ordem correta: Three.js primeiro, depois visualizador, depois app -->
    <script src="js/threejs-visualizer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>